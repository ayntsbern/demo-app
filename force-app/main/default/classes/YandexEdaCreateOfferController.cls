/**
 * Created by Yulia Yakushenkova on 17.09.2019.
 */

public with sharing class YandexEdaCreateOfferController {

    @AuraEnabled
    public static List<Contact> getInitData(String ID){
        return [SELECT Id, Name, Account.Name, Email FROM Contact WHERE AccountId =: ID];
    }

    @AuraEnabled
    public static Boolean createOffer(String accID){
        Account acc = [SELECT Id, Offer_Name__c FROM Account WHERE Id =: accID];
        if(acc.Offer_Name__c != null) return false;
            Offer__c offer = new Offer__c();
        try{
            insert offer;
            acc.Offer_Name__c = offer.Id;
            update acc;
        } catch (Exception e){
            return false;
        }
        return true;
    }

    @AuraEnabled
    public static void sendEmail(String contactId){
        Messaging.SingleEmailMessage message = new Messaging.SingleEmailMessage();
        String[] toAddresses = new String[] {'y.yakushenkova@ya.ru'};
        message.setToAddresses(toAddresses);
        message.subject = 'Opt Out Test Message';
        //message.plainTextBody = 'This is the message body.';
        message.setHtmlBody('Hello, <br/>' +
                '<br/>This is the test mail that you generated. ' +
                '<br/>The Email Id for which this mail was generated by me <br/>' +
                '<br/>Regards' +
                '<br/> Developer');
        Messaging.SingleEmailMessage[] messages =
                new List<Messaging.SingleEmailMessage> {message};
        Messaging.SendEmailResult[] results = Messaging.sendEmail(messages);
        if (results[0].success) {
            System.debug('The email was sent successfully.');
        } else {
            System.debug('The email failed to send: '
                    + results[0].errors[0].message);
        }
    }
}